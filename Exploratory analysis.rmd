---
title: "Exploratory analysis"
output:
  pdf_document: default
  html_document: default
---

```{r}
library(ggplot2)
library(gridExtra)
library(glmnet)
```
```{r}
# getwd()
#setwd('DATA 583/583-project')

# Load the data from the CSV file
data <- read.csv("data_whole.csv", header = TRUE, check.names = FALSE)
dim(data) # 2857, 33

## data cleaning
# remove y2, x6, x8, x9, x22, x29 because of missing values for some rows
data <- data[, -c(3, 9, 11, 12, 25, 32)]

# remove rows with missing values, obtain only weekly data, rather than daily
data <- na.omit(data)
dim(data) # 352, 27

# renme y1 to y
names(data)[2] <- "y"

#remove date
data_no_date <- data[, -1]

head(data)
```
As the raw data has missing values, we need to remove the rows with missing values. After removing the rows with missing values, we have 352 observations and 27 variables.
The response variable is y, which is .
The explanatory variables are x1 to x27, which are the .

The data structure is shown below.

```{r}
# The structure of the data,
# including the number of variables, their types, and the first few observations.
str(data)
```

Here is the summary statistics of the data.
```{r}
summary(data)
```

Let's explore the histogram of the response variable y and the explanatory variables.


```{r, warning = FALSE, message = FALSE}
# Create a histograms of the variables
hist_y <- ggplot(data, aes(x = y)) + geom_histogram() + labs(title = "Histogram of y")
hist_x1 <- ggplot(data, aes(x = x1)) + geom_histogram() + labs(title = "Histogram of x1")
hist_x2 <- ggplot(data, aes(x = x2)) + geom_histogram() + labs(title = "Histogram of x2")
hist_x3 <- ggplot(data, aes(x = x3)) + geom_histogram() + labs(title = "Histogram of x3")
hist_x4 <- ggplot(data, aes(x = x4)) + geom_histogram() + labs(title = "Histogram of x4")
hist_x5 <- ggplot(data, aes(x = x5)) + geom_histogram() + labs(title = "Histogram of x5")
hist_x7 <- ggplot(data, aes(x = x7)) + geom_histogram() + labs(title = "Histogram of x7")
hist_x10 <- ggplot(data, aes(x = x10)) + geom_histogram() + labs(title = "Histogram of x10")
hist_x11 <- ggplot(data, aes(x = x11)) + geom_histogram() + labs(title = "Histogram of x11")

grid.arrange(hist_y, hist_x1, hist_x2, hist_x3, hist_x4,
             hist_x5, hist_x7, hist_x10, hist_x11, ncol = 3)
```




```{r}
# Create a histogram of the response variable x12, x13, x14, x15, x16, x17, x18, x19, x20
hist_x12 <- ggplot(data, aes(x = x12)) + geom_histogram() + labs(title = "Histogram of x12")
hist_x13 <- ggplot(data, aes(x = x13)) + geom_histogram() + labs(title = "Histogram of x13")
hist_x14 <- ggplot(data, aes(x = x14)) + geom_histogram() + labs(title = "Histogram of x14")
hist_x15 <- ggplot(data, aes(x = x15)) + geom_histogram() + labs(title = "Histogram of x15")
hist_x16 <- ggplot(data, aes(x = x16)) + geom_histogram() + labs(title = "Histogram of x16")
hist_x17 <- ggplot(data, aes(x = x17)) + geom_histogram() + labs(title = "Histogram of x17")
hist_x18 <- ggplot(data, aes(x = x18)) + geom_histogram() + labs(title = "Histogram of x18")
hist_x19 <- ggplot(data, aes(x = x19)) + geom_histogram() + labs(title = "Histogram of x19")
hist_x20 <- ggplot(data, aes(x = x20)) + geom_histogram() + labs(title = "Histogram of x20")

grid.arrange(hist_x12, hist_x13, hist_x14, hist_x15, hist_x16,
             hist_x17, hist_x18, hist_x19, hist_x20,
             nrow = 3, ncol = 3)
```




```{r}
# Create a histogram of the response variable x21, x23, x24, x25, x26, x27, x28, x30
hist_x21 <- ggplot(data, aes(x = x21)) + geom_histogram() + labs(title = "Histogram of x21")
hist_x23 <- ggplot(data, aes(x = x23)) + geom_histogram() + labs(title = "Histogram of x23")
hist_x24 <- ggplot(data, aes(x = x24)) + geom_histogram() + labs(title = "Histogram of x24")
hist_x25 <- ggplot(data, aes(x = x25)) + geom_histogram() + labs(title = "Histogram of x25")
hist_x26 <- ggplot(data, aes(x = x26)) + geom_histogram() + labs(title = "Histogram of x26")
hist_x27 <- ggplot(data, aes(x = x27)) + geom_histogram() + labs(title = "Histogram of x27")
hist_x28 <- ggplot(data, aes(x = x28)) + geom_histogram() + labs(title = "Histogram of x28")
hist_x30 <- ggplot(data, aes(x = x30)) + geom_histogram() + labs(title = "Histogram of x30")

grid.arrange(hist_x21, hist_x23, hist_x24, hist_x25, hist_x26,
             hist_x27, hist_x28, hist_x30,
             nrow = 3, ncol = 3)
```




```{r}
# create scatterplots of the variables x1, x2, x3, x4, x5, x7, x10, x11, x12
scatter_x1 <- ggplot(data = data, aes(x = x1, y = y)) + geom_point() + labs(title = "Scatterplot of x1 and y")
scatter_x2 <- ggplot(data = data, aes(x = x2, y = y)) + geom_point() + labs(title = "Scatterplot of x2 and y")
scatter_x3 <- ggplot(data = data, aes(x = x3, y = y)) + geom_point() + labs(title = "Scatterplot of x3 and y")
scatter_x4 <- ggplot(data = data, aes(x = x4, y = y)) + geom_point() + labs(title = "Scatterplot of x4 and y")
scatter_x5 <- ggplot(data = data, aes(x = x5, y = y)) + geom_point() + labs(title = "Scatterplot of x5 and y")
scatter_x7 <- ggplot(data = data, aes(x = x7, y = y)) + geom_point() + labs(title = "Scatterplot of x7 and y")
scatter_x10 <- ggplot(data = data, aes(x = x10, y = y)) + geom_point() + labs(title = "Scatterplot of x10 and y")
scatter_x11 <- ggplot(data = data, aes(x = x11, y = y)) + geom_point() + labs(title = "Scatterplot of x11 and y")
scatter_x12 <- ggplot(data = data, aes(x = x12, y = y)) + geom_point() + labs(title = "Scatterplot of x12 and y")

grid.arrange(scatter_x1, scatter_x2, scatter_x3, scatter_x4, scatter_x5,
          scatter_x7, scatter_x10, scatter_x11, scatter_x12, ncol = 3, nrow = 3)
```

```{r}
# create scatterplots of the variables x13, x14, x15, x16, x17, x18, x19, x20, x21
scatter_x13 <- ggplot(data = data, aes(x = x13, y = y)) + geom_point() + labs(title = "Scatterplot of x13 and y")
scatter_x14 <- ggplot(data = data, aes(x = x14, y = y)) + geom_point() + labs(title = "Scatterplot of x14 and y")
scatter_x15 <- ggplot(data = data, aes(x = x15, y = y)) + geom_point() + labs(title = "Scatterplot of x15 and y")
scatter_x16 <- ggplot(data = data, aes(x = x16, y = y)) + geom_point() + labs(title = "Scatterplot of x16 and y")
scatter_x17 <- ggplot(data = data, aes(x = x17, y = y)) + geom_point() + labs(title = "Scatterplot of x17 and y")
scatter_x18 <- ggplot(data = data, aes(x = x18, y = y)) + geom_point() + labs(title = "Scatterplot of x18 and y")
scatter_x19 <- ggplot(data = data, aes(x = x19, y = y)) + geom_point() + labs(title = "Scatterplot of x19 and y")
scatter_x20 <- ggplot(data = data, aes(x = x20, y = y)) + geom_point() + labs(title = "Scatterplot of x20 and y")
scatter_x21 <- ggplot(data = data, aes(x = x21, y = y)) + geom_point() + labs(title = "Scatterplot of x21 and y")

grid.arrange(scatter_x13, scatter_x14, scatter_x15, scatter_x16, scatter_x17,
          scatter_x18, scatter_x19, scatter_x20, scatter_x21, ncol = 3, nrow = 3)
```

```{r}
# create scatterplots of the variables x23, x24, x25, x26, x27, x28, x30
scatter_x23 <- ggplot(data = data, aes(x = x23, y = y)) + geom_point() + labs(title = "Scatterplot of x23 and y")
scatter_x24 <- ggplot(data = data, aes(x = x24, y = y)) + geom_point() + labs(title = "Scatterplot of x24 and y")
scatter_x25 <- ggplot(data = data, aes(x = x25, y = y)) + geom_point() + labs(title = "Scatterplot of x25 and y")
scatter_x26 <- ggplot(data = data, aes(x = x26, y = y)) + geom_point() + labs(title = "Scatterplot of x26 and y")
scatter_x27 <- ggplot(data = data, aes(x = x27, y = y)) + geom_point() + labs(title = "Scatterplot of x27 and y")
scatter_x28 <- ggplot(data = data, aes(x = x28, y = y)) + geom_point() + labs(title = "Scatterplot of x28 and y")
scatter_x30 <- ggplot(data = data, aes(x = x30, y = y)) + geom_point() + labs(title = "Scatterplot of x30 and y")

grid.arrange(scatter_x23, scatter_x24, scatter_x25, scatter_x26, scatter_x27,
          scatter_x28, scatter_x30, ncol = 3, nrow = 3)
```

```{r}
# plot the variables versus date
trend_y <- ggplot(data = data, aes(x = date, y = y)) + geom_point() + labs(title = "Trend of y over time")
trend_x1 <- ggplot(data = data, aes(x = date, y = x1)) + geom_point() + labs(title = "Trend of x1 over time")
trend_x2 <- ggplot(data = data, aes(x = date, y = x2)) + geom_point() + labs(title = "Trend of x2 over time")
trend_x3 <- ggplot(data = data, aes(x = date, y = x3)) + geom_point() + labs(title = "Trend of x3 over time")
trend_x4 <- ggplot(data = data, aes(x = date, y = x4)) + geom_point() + labs(title = "Trend of x4 over time")
trend_x5 <- ggplot(data = data, aes(x = date, y = x5)) + geom_point() + labs(title = "Trend of x5 over time")
trend_x7 <- ggplot(data = data, aes(x = date, y = x7)) + geom_point() + labs(title = "Trend of x7 over time")
trend_x10 <- ggplot(data = data, aes(x = date, y = x10)) + geom_point() + labs(title = "Trend of x10 over time")
trend_x11 <- ggplot(data = data, aes(x = date, y = x11)) + geom_point() + labs(title = "Trend of x11 over time")

grid.arrange(trend_y, trend_x1, trend_x2, trend_x3, trend_x4, trend_x5,
          trend_x7, trend_x10, trend_x11, ncol = 3, nrow = 3)
```



```{r}
## applications of statistical analysis techniques
## fitting models

# fit a linear regression model
model_ls <- lm(y ~ ., data = data_no_date)
summary(model_ls)
```
```{r}
# fit a stepwise regression model
model_step <- step(model_ls, direction = "both")
summary(model_step)
```
```{r}
# fit a lasso regression model
model_lasso <- cv.glmnet(x = as.matrix(data_no_date[, -1]), y = data_no_date[, 1], alpha = 1)
model_lasso

# plot the lasso regression model
plot(model_lasso)
```
```{r}

```

